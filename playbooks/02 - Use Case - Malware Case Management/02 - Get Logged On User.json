{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "02 - Get Logged On User",
    "aliasName": null,
    "tag": null,
    "description": "Identify the user account logged on the device exfiltrating data",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "force_manual_input"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/389c8b50-4172-4340-8b0c-ad759d1703fa",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/35cb3e97-f9b9-4c1a-ba37-291b863dd406",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Comment_Manual Username Entry",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>{{globalVars.Action_Icon}} To enter the username manually, close the current record and browse to the Notification \ud83d\udd14 Icon on the top right of the UI&nbsp;<\/p>\n<p>Browse to&nbsp;<span style=\"color: #e67e23;\"><strong>Indicators <\/strong><\/span>and review &nbsp;the newly created user<\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "144bc4a7-e072-431e-adc7-a7ef0ca0a742"
        },
        {
            "@type": "WorkflowStep",
            "name": "Comment_Hunt Process Name",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>{{globalVars.Hint_Icon}} To find the process name, FortiSOAR uses the destination IP of the exfiltration alert as a filter on a FortiSIEM search query. Correlating the IP (<span style=\"color: #e67e23;\"><strong>{{vars.input.records[0].destinationIp}}<\/strong><\/span>) from the exfiltration with the endpoints network activity events help pinpointing the process at the origin of the exfiltration.<\/p>\n<p>The search\/hunt results are found under <span style=\"color: #e67e23;\"><strong>Correlations &gt;&gt; Events<\/strong><\/span><\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "225e7f7f-0b91-4dff-9135-4470dd7e85d5"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Previous Comment",
            "description": null,
            "arguments": {
                "arguments": {
                    "comments_IRIs": "{{vars.steps.Comment_Manual_Username_Entry['@id']}},{{vars.steps.Comment_Hunt_Exfiltration_Process['@id']}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/1ece048a-43ee-45b1-b860-5a4675a45ad2"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "2aaa04fe-dc79-4eb1-a3d9-4ffd1e8f78c3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "e4bce90e-9d7d-4a4d-9122-15ced5b5f556",
                "resources": [
                    "alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": [
                            {
                                "type": "object",
                                "field": "type",
                                "value": [
                                    "\/api\/3\/picklists\/a043fb35-f373-44c0-bfa9-5bce2f711141",
                                    "\/api\/3\/picklists\/0cbc2c31-c360-4770-b1e7-3653a8c24ead"
                                ],
                                "module": "type",
                                "display": "",
                                "operator": "in",
                                "template": "multiselectpicklist",
                                "OPERATOR_KEY": "$",
                                "displayTemplate": "",
                                "previousOperator": "in",
                                "previousTemplate": "multiselectpicklist"
                            }
                        ]
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "35cb3e97-f9b9-4c1a-ba37-291b863dd406"
        },
        {
            "@type": "WorkflowStep",
            "name": "Comment_Hunt Exfiltration Process",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>{{globalVars.Action_Icon}} <strong>Run playbook : <span style=\"background-color: #e67e23;\">Hunt Exfiltration Process<\/span><\/strong><strong> <\/strong>to identify the process sending data out.<\/p>\n<p>If found the <span style=\"color: #e67e23;\"><strong>process indicator<\/strong><\/span> will be linked to the current ticket, you can find it under <span style=\"color: #e67e23;\"><strong>Indicators<\/strong><\/span><\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "64857f92-5686-408e-8cec-04a74da39f19"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Logged On User",
            "description": null,
            "arguments": {
                "arguments": {
                    "comment_IRI": "{{vars.steps.Comment_Manual_Username_Entry['@id']}}",
                    "device_ip_address": "{{vars.input.records[0].sourceIp}}",
                    "parent_object_IRI": "{{vars.input.records[0]['@id']}}",
                    "force_manual_input": "True"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/2f631c0a-337d-41ef-ab60-3dd3c4a7b5de"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "a8640ff1-c48f-4e6d-95d1-2dd16d445985"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Start -> _GC_ Manual Username Entry",
            "targetStep": "\/api\/3\/workflow_steps\/144bc4a7-e072-431e-adc7-a7ef0ca0a742",
            "sourceStep": "\/api\/3\/workflow_steps\/35cb3e97-f9b9-4c1a-ba37-291b863dd406",
            "label": null,
            "isExecuted": false,
            "uuid": "47275acf-f5f0-4a15-ad13-ce4ca64f358a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Hunt Exfiltration Process -> Update Previous Comment",
            "targetStep": "\/api\/3\/workflow_steps\/2aaa04fe-dc79-4eb1-a3d9-4ffd1e8f78c3",
            "sourceStep": "\/api\/3\/workflow_steps\/64857f92-5686-408e-8cec-04a74da39f19",
            "label": null,
            "isExecuted": false,
            "uuid": "5dd96499-1f1a-40a3-889e-593e875bd259"
        },
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Populated Alert Fields -> _GC_ Hunt Exfiltration Process",
            "targetStep": "\/api\/3\/workflow_steps\/64857f92-5686-408e-8cec-04a74da39f19",
            "sourceStep": "\/api\/3\/workflow_steps\/225e7f7f-0b91-4dff-9135-4470dd7e85d5",
            "label": null,
            "isExecuted": false,
            "uuid": "6e67cf0e-1e94-4003-9d3d-d4f21ae62855"
        },
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Manual Username Entry -> _GC_ Populated Alert Fields",
            "targetStep": "\/api\/3\/workflow_steps\/225e7f7f-0b91-4dff-9135-4470dd7e85d5",
            "sourceStep": "\/api\/3\/workflow_steps\/144bc4a7-e072-431e-adc7-a7ef0ca0a742",
            "label": null,
            "isExecuted": false,
            "uuid": "ba46dc70-037a-4664-a722-488e64a6203c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update Previous Comment -> Get Logged On User",
            "targetStep": "\/api\/3\/workflow_steps\/a8640ff1-c48f-4e6d-95d1-2dd16d445985",
            "sourceStep": "\/api\/3\/workflow_steps\/2aaa04fe-dc79-4eb1-a3d9-4ffd1e8f78c3",
            "label": null,
            "isExecuted": false,
            "uuid": "c5edaa90-fed5-4606-9249-cd1f303ea801"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "0bdfcf54-cb1c-49df-b11c-37057eaf97c3",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Enrichment",
        "Alert"
    ]
}